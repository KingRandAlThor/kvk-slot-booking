{% extends 'layout.html' %}

{% block title %}Admin â€” KVK Slot Booking{% endblock %}

{% block content %}
  <h1>âš™ï¸ Admin Panel</h1>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="flash {{ category }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="admin-section">
    <h2>ğŸ“… Current Event Date</h2>
    <p style="font-size:1.3em; color:#00d9ff;">{{ current_date }}</p>
    <p>Total reservations: <strong>{{ reservation_count }}</strong></p>
  </div>

  <div class="admin-section">
    <h2>ğŸ”„ Change Event Date</h2>
    <form method="post" class="admin-form">
      <input type="hidden" name="action" value="set_date">
      <div>
        <label>New date (YYYY-MM-DD)</label>
        <input type="date" name="new_date" required>
      </div>
      <div>
        <label>Admin password</label>
        <input type="password" name="password" placeholder="Enter password" required>
      </div>
      <div style="margin-top:12px;">
        <button type="submit">ğŸ“… Set new date &amp; clear reservations</button>
      </div>
    </form>
  </div>

  <div class="admin-section">
    <h2>ğŸ—‘ï¸ Reset Reservations Only</h2>
    <form method="post" class="admin-form" onsubmit="return confirm('Are you sure you want to delete all reservations?');">
      <input type="hidden" name="action" value="reset">
      <div>
        <label>Admin password</label>
        <input type="password" name="password" placeholder="Enter password" required>
      </div>
      <button type="submit" style="background:#e74c3c;">ğŸ—‘ï¸ Clear all reservations</button>
    </form>
  </div>

  <div class="admin-section">
    <h2>âŒ Delete a Single Reservation</h2>
    {% if reservations and reservations|length > 0 %}
    <form method="post" class="admin-form" onsubmit="return confirm('Delete this reservation?');">
      <input type="hidden" name="action" value="delete_one">
      <div>
        <label>Select reservation to delete</label>
        <select name="reservation_id" required>
          <option value="">-- Select --</option>
          {% for r in reservations %}
            <option value="{{ r['id'] }}">{{ r['slot_start'][:16] }} - {{ r['player_name'] }} ({{ r['speedup_days'] }} days)</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>Admin password</label>
        <input type="password" name="password" placeholder="Enter password" required>
      </div>
      <button type="submit" style="background:#e67e22;">âŒ Delete selected</button>
    </form>
    {% else %}
    <p style="color:#888;">No reservations to delete.</p>
    {% endif %}
  </div>

  <div style="margin-top:32px;">
    <a class="btn" href="{{ url_for('index') }}">â† Back to booking</a>
  </div>
{% endblock %}
